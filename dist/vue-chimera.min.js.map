{"version":3,"file":"vue-chimera.min.js","sources":["../src/utils.js","../node_modules/p-debounce/index.js","../src/Resource.js","../src/NullResource.js","../src/VueChimera.js","../ssr/index.js","../src/mixin.js","../src/cache/MemoryCache.js","../src/index.js","../src/cache/StorageCache.js"],"sourcesContent":["import Axios from 'axios'\n\nexport function isPlainObject (value) {\n  return typeof value === 'object' && Object.prototype.toString(value) === '[object Object]'\n}\n\nexport function remove (arr, item) {\n  if (arr.length) {\n    const index = arr.indexOf(item)\n    if (index > -1) {\n      return arr.splice(index, 1)\n    }\n  }\n}\n\nexport const hasKey = (obj, key) => key in (obj || {})\n\nexport function mergeExistingKeys (...obj) {\n  let o = Object.assign(...obj)\n  return Object.keys(obj[0]).reduce((carry, item) => {\n    carry[item] = o[item]\n    return carry\n  }, {})\n}\n\nexport function createAxios (config) {\n  if (config instanceof Axios) {\n    return config\n  }\n  // Support nuxt axios\n  if (config && typeof config.$request === 'function') {\n    return config\n  }\n  if (isPlainObject(config)) {\n    return Axios.create(config)\n  }\n  if (typeof config === 'function') {\n    if (typeof config.request === 'function') return config\n    let axios = config()\n    if (axios instanceof Axios) return axios\n  }\n  return Axios\n}\n\nexport function noop () {}\n\nexport function noopReturn (arg) { return arg }\n","'use strict';\nmodule.exports = (fn, wait, opts) => {\n\tif (!Number.isFinite(wait)) {\n\t\tthrow new TypeError('Expected `wait` to be a finite number');\n\t}\n\n\topts = opts || {};\n\n\tlet leadingVal;\n\tlet timer;\n\tlet resolveList = [];\n\n\treturn function () {\n\t\tconst ctx = this;\n\t\tconst args = arguments;\n\n\t\treturn new Promise(resolve => {\n\t\t\tconst runImmediately = opts.leading && !timer;\n\n\t\t\tclearTimeout(timer);\n\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\ttimer = null;\n\n\t\t\t\tconst res = opts.leading ? leadingVal : fn.apply(ctx, args);\n\n\t\t\t\tfor (resolve of resolveList) {\n\t\t\t\t\tresolve(res);\n\t\t\t\t}\n\n\t\t\t\tresolveList = [];\n\t\t\t}, wait);\n\n\t\t\tif (runImmediately) {\n\t\t\t\tleadingVal = fn.apply(ctx, args);\n\t\t\t\tresolve(leadingVal);\n\t\t\t} else {\n\t\t\t\tresolveList.push(resolve);\n\t\t\t}\n\t\t});\n\t};\n};\n","import Axios from 'axios'\nimport { isPlainObject, noopReturn } from './utils'\nimport pDebounce from 'p-debounce'\nconst { CancelToken } = Axios\n\nexport const EVENT_SUCCESS = 'success'\nexport const EVENT_ERROR = 'error'\nexport const EVENT_CANCEL = 'cancel'\nexport const EVENT_LOADING = 'loading'\nexport const EVENT_TIMEOUT = 'timeout'\n\nconst INITIAL_DATA = {\n  loading: false,\n  status: null,\n  data: null,\n  headers: null,\n  error: null,\n  lastLoaded: null\n}\n\nexport default class Resource {\n  constructor (options, initial) {\n    if (typeof options === 'string') options = { url: options }\n\n    let {\n      autoFetch,\n      prefetch,\n      cache,\n      debounce,\n      transformer,\n      axios,\n      key,\n      interval,\n      ...request\n    } = options\n\n    request.method = (request.method || 'get').toLowerCase()\n\n    if (typeof autoFetch === 'string') {\n      this.autoFetch = autoFetch.toLowerCase() === request.method\n    } else {\n      this.autoFetch = Boolean(autoFetch)\n    }\n\n    this.key = key\n    this.prefetch = typeof prefetch === 'boolean' ? prefetch : this.autoFetch\n    this.cache = cache\n    this.axios = axios\n    this.fetchDebounced = pDebounce(this.fetch.bind(this), debounce, { leading: true })\n\n    // Set Transformers\n    this.setTransformer(transformer)\n\n    if (request.data) {\n      console.warn('[Chimera]: Do not use \"params\" key inside resource options, use data instead')\n    }\n\n    if (request.method !== 'get') {\n      request.data = request.params\n      delete request.params\n    }\n\n    this.request = {\n      ...request,\n      cancelToken: new CancelToken(c => {\n        this._canceler = c\n      })\n    }\n\n    this._listeners = {}\n    this.prefetched = false\n\n    // Set Events\n    if (isPlainObject(options.on)) {\n      for (let key in options.on) {\n        this.on(key, options.on[key])\n      }\n    }\n\n    initial && Object.assign(this, INITIAL_DATA, initial)\n  }\n\n  setTransformer (transformer) {\n    if (typeof transformer === 'function') {\n      this.responseTransformer = transformer\n      this.errorTransformer = transformer\n    } else if (isPlainObject('object')) {\n      const { response, error } = transformer\n      this.responseTransformer = response || noopReturn\n      this.errorTransformer = error || noopReturn\n    } else {\n      this.responseTransformer = noopReturn\n      this.errorTransformer = noopReturn\n    }\n  }\n\n  on (event, handler) {\n    let listeners = this._listeners[event] || []\n    listeners.push(handler)\n    this._listeners[event] = listeners\n    return this\n  }\n\n  emit (event) {\n    (this._listeners[event] || []).forEach(handler => {\n      handler(this, event)\n    })\n  }\n\n  fetch (force, extraParams, extraOptions) {\n    return new Promise((resolve, reject) => {\n\n      if (this.cache && !force) {\n        let cacheValue = this.getCache()\n        if (cacheValue) {\n          this.setByResponse(cacheValue)\n          return resolve(cacheValue)\n        }\n      }\n\n      this.loading = true\n      this.emit(EVENT_LOADING)\n\n      // Merge extra options\n      let { request } = this\n      if (isPlainObject(extraOptions)) {\n        request = Object.assign({}, request, isPlainObject(extraOptions) ? {} : {})\n      }\n      // Merge extra params\n      if (isPlainObject(extraParams)) {\n        const paramKey = request.method === 'get' ? 'params' : 'data'\n        request[paramKey] = Object.assign(request[paramKey], extraParams)\n      }\n\n      // Finally make request\n      this.axios.request(request).then(res => {\n        this.setByResponse(res)\n        this.setCache(res)\n        this.emit(EVENT_SUCCESS)\n        resolve(res)\n      }).catch(err => {\n        this.setByResponse(err.response)\n        if (Axios.isCancel(err)) {\n          this.emit(EVENT_CANCEL)\n        } else if (err.message && !err.response && err.message.indexOf('timeout') !== -1) {\n          this.emit(EVENT_TIMEOUT)\n        } else {\n          this.emit(EVENT_ERROR)\n        }\n\n        reject(err)\n      }).finally(() => {\n        this.loading = false\n      })\n    })\n  }\n\n  reload (force) {\n    return this.fetchDebounced(force)\n  }\n\n  send (params, options) {\n    return this.fetchDebounced(true, params, options)\n  }\n\n  cancel (unload) {\n    if (unload) this.data = null\n    if (typeof this._canceler === 'function') this._canceler()\n    this.request.cancelToken = new CancelToken(c => { this._canceler = c })\n  }\n\n  getCacheKey () {\n    if (this.key) return this.key\n    return (typeof window !== 'undefined' && typeof btoa !== 'undefined'\n      ? window.btoa\n      : x => x)(this.request.url +\n      this.request.params +\n      this.request.data +\n      this.request.method)\n  }\n\n  getCache () {\n    return this.cache ? this.cache.getItem(this.getCacheKey()) : undefined\n  }\n\n  setCache (value) {\n    this.cache && this.cache.setItem(this.getCacheKey(), value)\n  }\n\n  deleteCache () {\n    this.cache && this.cache.removeItem(this.getCacheKey())\n  }\n\n  setByResponse (res) {\n    res = res || {}\n    const isSuccessful = String(res.status).charAt(0) === '2'\n    this.status = res.status\n    this.headers = res.headers || {}\n    this.lastLoaded = new Date()\n    this.data = isSuccessful ? this.responseTransformer(res.data, this) : null\n    this.error = !isSuccessful ? this.errorTransformer(res.data, this) : null\n  }\n\n  startInterval (ms) {\n    if (typeof ms !== 'number') throw new Error('[Chimera]: interval should be number')\n    if (typeof process !== 'undefined' && process.server) return\n\n    this._interval = ms\n    this.stopInterval()\n    this._interval_id = setInterval(() => this.reload(true), this._interval)\n    this.looping = true\n  }\n\n  stopInterval () {\n    if (this._interval_id) {\n      clearInterval(this._interval_id)\n      this.looping = false\n      this._interval_id = null\n      this._interval = false\n    }\n  }\n\n  toObj () {\n    const json = {}\n    Object.keys(INITIAL_DATA).forEach(key => {\n      json[key] = this[key]\n    })\n    return json\n  }\n\n  toString () {\n    return JSON.stringify(this.toObj())\n  }\n\n  get params () {\n    return this.request.method === 'get' ? this.request.params : this.request.data\n  }\n\n  get url () {\n    return this.request.url\n  }\n\n  get method () {\n    return this.request.method\n  }\n}\n","import Resource from './Resource'\n\nexport default class NullResource extends Resource {\n  fetch (force) {\n    return Promise.reject(new Error('Null Resource'))\n  }\n\n  cancel () {}\n}\n","import Resource from './Resource'\nimport NullResource from './NullResource'\nimport { createAxios, hasKey, isPlainObject, noop } from './utils'\n\nexport default class VueChimera {\n  constructor (vm, { ...resources }, { deep, ...options }) {\n    this._vm = vm\n    this._watchers = []\n\n    this._axios = options.axios = createAxios(options.axios)\n    this._options = options\n    this._deep = deep\n    this._server = vm.$isServer\n    const watchOption = {\n      immediate: true,\n      deep: this._deep,\n      sync: true\n    }\n\n    for (let key in resources) {\n      if (key.charAt(0) === '$') continue\n\n      let r = resources[key]\n      if (typeof r === 'function') {\n        this._watchers.push([\n          () => r.call(this._vm),\n          (t, f) => this.updateResource(key, t, f),\n          watchOption\n        ])\n      } else {\n        resources[key] = this.resourceFrom(r)\n        !this._server && resources[key].reload()\n      }\n    }\n\n    Object.defineProperty(resources, '$cancelAll', { value: this.cancelAll.bind(this) })\n    Object.defineProperty(resources, '$axios', { get: () => this._axios })\n    Object.defineProperty(resources, '$loading', { get () { return !!Object.values(this).find(el => !!el.loading) } })\n    this._resources = resources\n\n    // Init computeds\n    const vmOptions = this._vm.$options\n    const computeds = vmOptions.computed = vmOptions.computed || {}\n    Object.keys(resources).forEach(key => {\n      if (hasKey(computeds, key) || hasKey(vmOptions.props, key) || hasKey(vmOptions.methods, key)) return\n      computeds[key] = () => this._resources[key]\n    })\n  }\n\n  init () {\n    this._watchers = this._watchers.map(w => this._vm.$watch(...w))\n  }\n\n  initServer () {\n    this._vm.$_chimeraPromises = Object.values(this._resources).map(r => {\n      if (r.prefetch) {\n        if (!r.key) {\n          console.warn('[Chimera]: used prefetch with no key associated with resource!')\n          return noop\n        }\n        return () => {\n          return r.fetch(true).catch(() => null).then(() => r)\n        }\n      }\n      return noop\n    })\n  }\n\n  updateResource (key, newValue, oldValue) {\n    const oldResource = this._resources[key]\n    const newResource = this.resourceFrom(newValue, oldValue && oldValue.keepData ? oldResource.toObj() : null)\n\n    if (oldValue && oldResource) {\n      oldResource.stopInterval()\n      newResource.lastLoaded = oldResource.lastLoaded\n    }\n\n    if (!this._server) {\n      if (newValue.interval) {\n        newResource.startInterval(newValue.interval)\n      }\n\n      if (newResource.autoFetch) newResource.reload()\n    }\n    this._vm.$set(this._resources, key, newResource)\n  }\n\n  resourceFrom (value, initial) {\n    if (value == null) return new NullResource()\n    if (typeof value === 'string') value = { url: value }\n\n    if (isPlainObject(value.on)) {\n      Object.entries(value.on).forEach(([event, handler]) => {\n        if (typeof handler === 'function') {\n          handler = handler.bind(this._vm)\n        }\n        if (typeof handler === 'string') handler = this._vm[handler]\n        value.on[event] = handler\n      })\n    }\n\n    const baseOptions = Object.create(this._options)\n    return new Resource(Object.assign(baseOptions, value), initial)\n  }\n\n  cancelAll () {\n    Object.values(this._resources).forEach(r => {\n      r.cancel()\n    })\n  }\n\n  destroy () {\n    const vm = this._vm\n\n    this.cancelAll()\n    delete vm._chimera\n  }\n}\n","const results = {}\n\nexports.addResource = function (r) {\n    results[r.key] = r.toObj()\n}\n\nexports.getStates = function () {\n    return results\n}\n\nexports.serializeStates = function () {\n    return JSON.stringify(results)\n}\n\nexports.exportStates = function (attachTo, globalName) {\n    return `${attachTo}.${globalName} = ${serializeStates()};`\n}\n","import VueChimera from './VueChimera'\nimport ChimeraSSR from '../ssr/index'\nimport { isPlainObject } from './utils'\n\nexport default (options = {}) => ({\n  beforeCreate () {\n    const vmOptions = this.$options\n    let _chimera\n\n    // Stop if instance doesn't have chimera or already initialized\n    if (!vmOptions.chimera || vmOptions._chimera) return\n\n    if (typeof vmOptions.chimera === 'function') {\n      // Initialize with function\n      vmOptions.chimera = vmOptions.chimera.call(this)\n    }\n\n    if (vmOptions.chimera instanceof VueChimera) {\n      _chimera = vmOptions.chimera\n    } else if (isPlainObject(vmOptions.chimera)) {\n      const { $options, ...resources } = vmOptions.chimera\n      _chimera = new VueChimera(this, resources, { ...options, ...$options })\n    }\n\n    // Nuxtjs prefetch\n    // const NUXT = typeof process !== 'undefined' && process.server && this.$ssrContext\n    //   ? this.$ssrContext.nuxt\n    //   : (typeof window !== 'undefined' ? window.__NUXT__ : null)\n    // if (_chimera && NUXT && NUXT.chimera) {\n    //   try {\n    //     if (this.$router) {\n    //       let matched = this.$router.match(this.$router.currentRoute.fullPath);\n    //       (matched ? matched.matched : []).forEach((m, i) => {\n    //         let nuxtChimera = NUXT.chimera[i]\n    //         if (nuxtChimera) {\n    //           Object.keys(_chimera.resources).forEach(key => {\n    //             let localResource = _chimera.resources[key]\n    //             let ssrResource = nuxtChimera[key]\n    //             if (localResource && ssrResource && ssrResource._data) {\n    //               [\n    //                 '_data', '_status', '_headers', 'ssrPrefetched',\n    //                 '_lastLoaded'].forEach(key => {\n    //                 localResource[key] = ssrResource[key]\n    //               })\n    //             }\n    //           })\n    //         }\n    //       })\n    //       // if (process.client) {\n    //       //   delete NUXT.chimera\n    //       // }\n    //     }\n    //   } catch (e) {}\n    // }\n    this._chimera = _chimera\n    Object.defineProperty(this, '$chimera', {\n      get: () => _chimera._resources\n    })\n  },\n\n  data () {\n    if (!this._chimera) return {}\n    return {\n      $chimera: this._chimera._resources\n    }\n  },\n\n  created () {\n    if (!this._chimera) return\n    this._chimera.init()\n    this.$isServer && this._chimera.initServer()\n  },\n\n  serverPrefetch () {\n    if (!this.$_chimeraPromises) return\n    return Promise.all(this.$_chimeraPromises.map(p => p())).then(results => {\n      results.forEach(r => {\n        r && ChimeraSSR.addResource(r)\n      })\n    })\n  }\n})\n","export class MemoryCache {\n  constructor (expiration) {\n    this.expiration = expiration || 1000 * 60\n    this._store = {}\n  }\n\n  /**\n     *\n     * @param key         Key for the cache\n     * @param value       Value for cache persistence\n     * @param expiration  Expiration time in milliseconds\n     */\n  setItem (key, value, expiration) {\n    this._store[key] = {\n      expiration: Date.now() + (expiration || this.expiration),\n      value\n    }\n  }\n\n  /**\n     * If Cache exists return the Parsed Value, If Not returns {null}\n     *\n     * @param key\n     */\n  getItem (key) {\n    let item = this._store[key]\n\n    if (item && item.value && Date.now() <= item.expiration) {\n      return item.value\n    }\n\n    console.log('sss')\n\n    this.removeItem(key)\n    return null\n  }\n\n  removeItem (key) {\n    delete this._store[key]\n  }\n\n  keys () {\n    return Object.keys(this._store)\n  }\n\n  all () {\n    return this.keys().reduce((obj, str) => {\n      obj[str] = this._store.getItem(str)\n      return obj\n    }, {})\n  }\n\n  length () {\n    return this.keys().length\n  }\n\n  clearCache () {\n    this._store = {}\n  }\n}\n","import mixin from './mixin'\n\nconst plugin = {\n\n  options: {\n    axios: null,\n    cache: null,\n    debounce: 50,\n    deep: true,\n    keepData: true,\n    autoFetch: 'get', // false, true, '%METHOD%',\n    prefetch: null,\n    prefetchTimeout: 4000,\n    transformer: null\n  },\n\n  install (Vue, options = {}) {\n    Object.keys(options).forEach(key => {\n      if (key in this.options) {\n        this.options[key] = options[key]\n      }\n    })\n\n    Vue.mixin(mixin(this.options))\n  }\n\n}\n\n// Auto-install\nlet GlobalVue = null\nif (typeof window !== 'undefined') {\n  GlobalVue = window.Vue\n} else if (typeof global !== 'undefined') {\n  GlobalVue = global.Vue\n}\n\nif (GlobalVue) {\n  GlobalVue.use(plugin, plugin.options)\n}\n\nexport default plugin\n\nexport * from './Resource'\nexport { StorageCache } from './cache/StorageCache'\nexport { MemoryCache } from './cache/MemoryCache'\n","import { MemoryCache } from './MemoryCache'\n\nexport class StorageCache extends MemoryCache {\n  constructor (key, expiration, sessionStorage = false) {\n    super(expiration)\n    this.key = key\n\n    const storage = sessionStorage ? 'sessionStorage' : 'localStorage'\n    if (typeof window === 'undefined' || !window[storage]) {\n      throw Error(`StorageCache: ${storage} is not available.`)\n    } else {\n      this.storage = window[storage]\n    }\n\n    try {\n      this._store = JSON.parse(this.storage.getItem(key)) || {}\n    } catch (e) {\n      this.clearCache()\n      this._store = {}\n    }\n  }\n\n  setItem (key, value, expiration) {\n    super.setItem(key, value, expiration)\n    this.storage.setItem(this.key, JSON.stringify(this._store))\n  }\n\n  clearCache () {\n    this.storage.removeItem(this.key)\n  }\n}\n"],"names":["isPlainObject","value","Object","prototype","toString","hasKey","obj","key","noop","noopReturn","arg","fn","wait","opts","Number","isFinite","TypeError","leadingVal","timer","resolveList","ctx","this","args","arguments","Promise","resolve","runImmediately","leading","clearTimeout","setTimeout","res","apply","push","CancelToken","Axios","EVENT_SUCCESS","EVENT_ERROR","EVENT_CANCEL","EVENT_LOADING","EVENT_TIMEOUT","INITIAL_DATA","loading","status","data","headers","error","lastLoaded","Resource","constructor","options","initial","url","autoFetch","prefetch","cache","debounce","transformer","axios","interval","request","method","toLowerCase","Boolean","fetchDebounced","pDebounce","fetch","bind","setTransformer","console","warn","params","cancelToken","c","_canceler","_listeners","prefetched","on","assign","responseTransformer","errorTransformer","response","event","handler","listeners","emit","forEach","force","extraParams","extraOptions","reject","cacheValue","getCache","setByResponse","paramKey","then","setCache","catch","err","isCancel","message","indexOf","finally","reload","send","cancel","unload","getCacheKey","window","btoa","x","getItem","undefined","setItem","deleteCache","removeItem","isSuccessful","String","charAt","Date","startInterval","ms","Error","process","server","_interval","stopInterval","_interval_id","setInterval","looping","clearInterval","toObj","json","keys","JSON","stringify","NullResource","VueChimera","vm","resources","deep","_vm","_watchers","_axios","config","$request","create","createAxios","_options","_deep","_server","$isServer","watchOption","immediate","sync","r","call","t","f","updateResource","resourceFrom","defineProperty","cancelAll","get","values","find","el","_resources","vmOptions","$options","computeds","computed","props","methods","init","map","w","$watch","initServer","$_chimeraPromises","newValue","oldValue","oldResource","newResource","keepData","$set","entries","baseOptions","destroy","_chimera","results","exports","beforeCreate","chimera","$chimera","created","serverPrefetch","all","p","ChimeraSSR","MemoryCache","expiration","_store","now","item","log","reduce","str","length","clearCache","plugin","prefetchTimeout","install","Vue","mixin","GlobalVue","global","use","sessionStorage","storage","parse","e"],"mappings":"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"}